
@{
    ViewData["Title"] = "GenerateReports";
    var Students = ViewBag.Students;
    var instructors=ViewBag.Instructors;
    var Departments = ViewBag.Departments;
    var Courses = ViewBag.Courses;
    var studentExams = ViewBag.studentExams;
    var Exams = ViewBag.Exams;
    var ExamQustions = ViewBag.examQuestions;
}

<h1>Generate Reports</h1>
<div class="d-block">
    <div class="m-2">
        <select id="instructorSelect">
            <option value="">Select Instructor</option>
            @foreach (var instructor in instructors)
            {
                <option value="@instructor.UserId">@instructor.UserName</option>
            }
        </select>
        <a id="instructorReportLink" class="btn btn-danger" asp-controller="Reports" asp-action="GetInstCoursAndStdReport" asp-route-instId="">Instructor Courses and Students</a>
        </div>
    <div class="m-2">
<select id="Deptselect">
<option value="">Select Department</option>
@foreach (var dept in Departments)
{
                <option value="@dept.DepId">@dept.DepName</option>
}
</select>
        <a id="DepratmentReport" class="btn btn-danger " asp-controller="Reports" asp-action="GetStudentsByDeptNums" asp-route-deptNum=""> Students By Department</a>
    </div>


    <div class="m-2">
<select id="CourseSelect">
<option value="">Select Course</option>
@foreach (var course in Courses)
{
                <option value="@course.CrsId">@course.CrsName</option>
}
</select>
        <a id="CourseTopicReports"  class="btn btn-danger" asp-controller="Reports" asp-action="GetCourseTopics" asp-route-crsId=""> Course Topics</a>
    </div>
    
    <div class="m-2">

        <select id="examSelect">
            <option value="">ExamId</option>
            @foreach (var exam in studentExams)
            {
                <option value="@exam.ExamId">@exam.ExamId</option>
            }
        </select>

        <select id="studentSelect">
            <option value="">StudentId</option>
            @foreach (var student in studentExams)
            {
                <option value="@student.StdId">@student.StdId</option>
            }
        </select>
        <a id="ExamQuestions" class="btn btn-danger" asp-controller="Reports" asp-action="get_exam_questions_with_student_answers" asp-route-ExamId="" asp-route-stdId="">Exam Questions with Student Answers</a>

    </div>


    <div class="m-2">

        <select id="ExamSelectChoice">
            <option value="">ExamId</option>

            @foreach (var ExamNum in Exams  )
            {
                <option value="@ExamNum.ExamId">@ExamNum.ExamId</option>
            }
        </select>

        <a id="ExamChoice" class="btn btn-danger " asp-controller="Reports" asp-action="GetExamChoices" asp-route-ExamId=""> Exam Choices</a>

    </div>
</div>








@section Scripts{
    <script>
        $(document).ready(function () {
            $("#instructorSelect").change(function () {
                var instId = $(this).val();
                $("#instructorReportLink").attr("href", "/Reports/GetInstCoursAndStdReport?instId=" + instId);

            });
            $("#Deptselect").change(function () {
                var deptNum = $(this).val();
                $("#DepratmentReport").attr("href", "/Reports/GetStudentsByDeptNums?deptNum=" + deptNum);
            });
            $("#CourseSelect").change(function () {
                var crsId = $(this).val();
                $("#CourseTopicReports").attr("href", "/Reports/GetCourseTopics?crsId=" + crsId);
            });

            
                // Function to update the href based on current selections
                function updateLinkHref() {
                    var examId = $('#examSelect').val();
                    var stdId = $('#studentSelect').val();

                    // Build the new href only if both an exam and a student have been selected
                    // This checks if both dropdowns have a non-empty value selected
                    if (examId && stdId) {
                        var baseHref = "/Reports/get_exam_questions_with_student_answers";
                        var newHref = `${baseHref}?ExamId=${examId}&stdId=${stdId}`;
                        $('#ExamQuestions').attr('href', newHref);
                    }
                }

                // Attach the update function to change events for both selects
                $("#examSelect, #studentSelect").change(updateLinkHref);
           



            $("#ExamSelectChoice").change(function () {
                var ExmaId = $(this).val();
                $("#ExamChoice").attr("href","/Reports/GetExamChoices?ExamId=" + ExmaId);
            })


        });
    </script>
}
```
